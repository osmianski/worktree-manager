#!/usr/bin/env php
<?php

$version = '0.1.7';

if (file_exists(__DIR__.'/../../../autoload.php')) {
    require __DIR__.'/../../../autoload.php';
}
else {
    require __DIR__.'/../vendor/autoload.php';
}

// Detect if running from development environment
if (is_dir(__DIR__ . '/../.git')) {
    $branch = trim(shell_exec('git -C ' . escapeshellarg(__DIR__ . '/..') . ' rev-parse --abbrev-ref HEAD 2>/dev/null') ?? '');
    $version = $branch ? "dev-$branch" : 'dev';
}

$app = new \Osmianski\WorktreeManager\Application('Worktree Manager', $version);
$app->add(new \Osmianski\WorktreeManager\Commands\AllocateCommand());
$app->add(new \Osmianski\WorktreeManager\Commands\AllocationsCommand());
$app->add(new \Osmianski\WorktreeManager\Commands\ConfigReservePortCommand());
$app->add(new \Osmianski\WorktreeManager\Commands\DownCommand());
$app->add(new \Osmianski\WorktreeManager\Commands\HelpListCommand());
$app->add(new \Osmianski\WorktreeManager\Commands\InstallCommand());
$app->add(new \Osmianski\WorktreeManager\Commands\ListCommand());
$app->add(new \Osmianski\WorktreeManager\Commands\MigrateCommand());
$app->add(new \Osmianski\WorktreeManager\Commands\NewCommand());
$app->add(new \Osmianski\WorktreeManager\Commands\RemoveCommand());
$app->add(new \Osmianski\WorktreeManager\Commands\RootAddCommand());
$app->add(new \Osmianski\WorktreeManager\Commands\RootListCommand());
$app->add(new \Osmianski\WorktreeManager\Commands\RootRemoveCommand());
$app->add(new \Osmianski\WorktreeManager\Commands\ScanCommand());
$app->add(new \Osmianski\WorktreeManager\Commands\UpCommand());
$app->run();
